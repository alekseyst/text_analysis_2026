# Электронные таблицы как инструмент работы с текстовыми данными

Excel / Google Таблицы — сильный инструмент, который довольно многое может. Когда задача, которую нужно решить, не требует особенно нетривиальных преобразований данных и когда лень программировать, можно воспользоваться ими.

Мы будем работать с Google Таблицами, но более-менее все электронные таблицы работают похоже, и при поиске какой-то информации можно искать её для Excel'я (но осторожно: в последнем в качестве разделителя аргументов функции используется ",", а в первых — ";").

Мы познакомимся лишь с частью функциональности электронных таблиц. Более подробно можно познакомиться с ними, например, [здесь](https://practicum.yandex.ru/excel-for-work/).

## Датасет

Наш [датасет](https://docs.google.com/spreadsheets/d/1T1JWUyjOh5rMoBnDOGZrWMK19Upf2M8mF_UNrnj-bfk/edit?usp=sharing). Он содержит:

- несколько сотен предложений Чехова
- несколько сотен предложений Толстого
- несколько сотен предложений, написанных обыкновенными людьми — например, тексты с форумов
- такой датасет легко получить из [Национального корпуса русского языка](https://ruscorpora.ru/)

Каждая строчка содержит собственно предложение, автора и год создания текста.

## Цель

В результате выполнения задания вы должны будете проверить, кто из перечисленных авторов длиннее пишет. Правда ли у Толстого предложения по полстраницы, а у Чехова — короче обычного?

## Немного компьютерной грамотности: упрощение жизни в таблицах

- если зажать Shift, а затем последовательно нажать на две ячейки, можно выделить диапазон между ними
- если зажать Shift, а затем выделить последовательно два диапазона — выделится всё между ними (можно оторвать палец от шифта, например, для перемотки к совсем другой части таблицы — главное, чтобы он был зажат при выделении второго диапазона)
- если зажать Ctrl, можно выделить любое количество не находящихся друг рядом с другом ячеек или диапазонов
- Сtrl-A — выделить всё
- Ctrl-Z — отменить действие, Ctrl-Shift-Z — отменить отмену действия
- Ctrl-C — скопировать, Ctrl-V — вставить (мало ли), Ctrl-Shift-V — вставить только значение (без формул и форматирования)
- [другие горячие клавиши](https://support.google.com/docs/answer/181110?hl=ru&co=GENIE.Platform%3DDesktop#zippy=)
- если зажать правый угол клетки и потянуть — произойдёт магия (таблица заполнит клетку так, как считает правильным)

## Своя таблица

Перед работой с таблицей сделайте себе её копию.

## Перед работой с данными: чистка

Как кажется, с данными что-то не так. Сравните 4, 5, 6 и 7 строчку. Да и ниже что-то такое встречается.

В целом, обычно так и происходит: перед тем, как данные можно использовать, приходится их чистить и приводить в удобоваримый вид. Нам необходимо удалить повторяющиеся строки: произвести дедупликацию.

**Как это сделать:** Данные → Очистка данных → Убрать повторы

## Подсчёты и формулы

Таблицы могут не просто что-то содержать в клетках, но и выполнять довольно сложные математические операции и разные операции с текстом.

Подсчитаем количество символов в каждом предложении.

**Как это сделать:**

- выбрать отдельный столбец, в котором буду подсчёты
- стоит его озаглавить
- вставьте в любую ячейку (назовём её Рассчитываемой) функцию =ДЛСТР(ячейка) и замените слово "ячейка" на номер ячейки (назовём ещё Исходной) с предложением в той же строчке (в том числе для этого можно нажать на пробел внутри пустых скобок и ткнуть мышкой в подходящее место)
- скопируйте эту Рассчитывемую ячейку во все остальные клетки столбца (правильная Исходная ячейка с предложением из точной строчки подставится сама)

Подсчитаем количество слов в ячейке. Это уже более сложная задача, но с помощью Google'а возможно всё!

**Как это сделать:** используйте функцию =ДЛСТР(СЖПРОБЕЛЫ(Ячейка))-ДЛСТР(ПОДСТАВИТЬ(Ячейка;" ";""))+1

## Сортировки и фильтры

Найдите самое длинное и самое короткое предложение с точки зрения количества слов и сточки зрения количества символов. Для этого используйте сортировку.

**Как это сделать:** 

- выберите диапазон, который хотите сортировать (например, всё)
- Данные  → Сортировать диапазон  → Расширенные настройки сортировки диапазонов
- отметьте галочкой _Данные со строкой заголовка_
- выберите столбец, по которому сортировать
- выберите, по возрастанию или убыванию
- чтобы посмотреть самое длинное и самое короткое предложение для каждого из авторов отдельно, можно нажать _Добавить ещё один столбец для сортировки_; в таком случае сначала надо сортировать по автору, затем по длине предложения

Сделайте то же самое, используя _Фильтр_.

**Как это сделать:** 
- выберите диапазон
- Данные  → Создать фильтр
- нажать на треугольник из трёх полосок в первой клетке нужного столбца
- выбрать необходимые настройки

Важное различие: если вы настроили фильтр так, чтобы он показывал только часть значений, эти значения в таблице сохраняются и станут видны после изменения или удаления фильтра. Если вы выполнили с помощью фильтра сортировку, она сохранится.

## Подсчёт метрик

Подсчитайте для каждого автора, сколько всего слов он использовал в своих предложениях из датасета.

Подсчитайте среднее количество слов в предложении у каждого автора.

**Как это сделать:**  используйте функции =СУММ() и =СРЗНАЧ(). В них нужно подставлять диапазоны (можно выделить их мышкой или используя Shift). Перед этим придётся сделать так, чтобы у каждого из авторов предложения шли подряд.

Какая метрика, на ваш взгляд, лучше?

## Внезапные гости

Если вы до сих пор его не заметили, обратите внимание, что в табличке встречается некий Ал. П. Чехова. Процесс очищения данных иногда приходится проводить не только перед началом обработки.

## Сравнение

Подсчитайте среднее количество слов в предложении для всех авторов вместе.

Добавьте столбец, в котором указано для каждого предложения, длиннее оно среднего или короче.

**Как это сделать:**  используйте сравнение ">". Чтобы ячейка со средним по всем авторам не "сползала", поставьте $ перед буквой и цифрой названия ячейки.

Комментарий: сравнение выдаст вам значение ИСТИНА или ЛОЖЬ. Для нас этого достаточно, но если вам хочется вместо истины или лжи иметь что-то ещё, можно использовать функцию =ЕСЛИ(). Так, выражение =ЕСЛИ(A1 < A2; 1; 0) впишет в ячейку 1, если А1 действительно меньше А2, и 0 в остальных случаях.

## Сводные таблицы

Сводные таблицы — один из удобнейших способов превратить данные в читаемые человеком, обобщить их.

Например, мы можем легко получить таблицу, в которой указано сколько предложений какого автора встречается в тексте.

**Как это сделать:**  

- выделите диапазон, в который входят интересующие вас данные (можно и больший — это не страшно)
- Вставка  → Создать сводную таблицу  → новый лист  → Создать
- Строки  → Добавить  → Автор
- Значения → Добавить → COUNTA

Среднее, которое выше считалось вручную для каждого автора, можно быстро посчитать, используя сводную таблицу.

**Как это сделать:**  

- в поле _Значение_ используйте функцию AVERAGE

Создайте сводную таблицу где для каждого автора подсчитано, сколько предложений у него длиннее среднего, а сколько короче.

**Как это сделать:**  

- выберите для строк сводной таблицы столбец _Автор_, для столбцов — тот, что у вас соответствует сравнению со средним

## Графики

Электронные таблицы предоставляют достаточно много возможностей при построении графиков — хотя ими и не всегда удобно пользоваться.

### Гистограмма

Постройте гистограмму — график, который содержит информацию о количестве каждого из значений в датасете — для столбца с количеством слов в столбце. Это позволит понять, как предложения разных размеров распределены в тексте: сколько чаще всего слов в предложении, а сколько бывает редко.

**Как это сделать:**  

- Вставка  → Диаграмма
- Тип диаграммы   → Другие   →  Гистограмма
- можно настроить, насколько дробно диаграмма делит пространство вариантов (например, считает предложения длиной 1 и 2 вместе или отдельно); Дополнительные   → Гистограмма   → Размер сегмента
- далее с помощью фильтра можно посмотреть на гистограмму для каждого отдельного автора

### График

Постройте график, который показывает соотношение количества слов в столбце и года написания текста.

**Как это сделать:**  

- отсортируйте таблицу по году (иначе на графике годы будут в произвольном порядке)
- Вставка  → Диаграмма
- Тип диаграммы   → Графики →  График
- Ось X   → Дата
- Поставить галочку в _Объединить_
- Параметр → удалить всё, кроме названия столбца, в котором указано количество слов в предложении
- Три точки у названия столбца  → Среднее
- далее с помощью фильтра можно посмотреть на графика для каждого отдельного автора

Что можно сказать о распределении по годам? Почему может так выглядеть распределение для коллективного автора?


